name: PR Labels (area + size + type)

on:
  pull_request_target:
    types: [opened, reopened, synchronize, edited]

permissions:
  contents: read
  pull-requests: write

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout base branch (safe)
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.base.ref }}

      - name: Apply area labels
        uses: actions/labeler@v5
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          configuration-path: .github/labeler.yml

        # Size labels by PR size (lines changed)
      - name: Apply size labels
        uses: codelytv/pr-size-labeler@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          xs_label: "size/extra-small"
          s_label: "size/small"
          m_label: "size/medium"
          l_label: "size/large"
          xl_label: "size/extra-large"
          # Thresholds
          xs_max_size: "10"
          s_max_size: "100"
          m_max_size: "500"
          l_max_size: "1000"
          # > l_max_size => XL

      - name: Apply type labels from PR title
        uses: bcoe/conventional-release-labels@v1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          type_labels: |
            {
              "feat": "enhancement",
              "fix": "bug",
              "hotfix": "bug",
              "bugfix": "bug",
              "security": "security-issue",
              "chore": "enhancement",
              "docs": "documentation",
              "refactor": "enhancement",
              "perf": "enhancement",
              "test": "enhancement",
              "build": "enhancement",
              "ci": "enhancement"
            }
